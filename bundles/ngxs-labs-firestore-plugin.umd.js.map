{"version":3,"file":"ngxs-labs-firestore-plugin.umd.js","sources":["../../../src/lib/ngxs-firestore-connect.actions.ts","../../../src/lib/ngxs-firestore.state.ts","../../../src/lib/tokens.ts","../../../src/lib/actions.ts","../../../src/lib/ngxs-firestore-page.service.ts","../../../src/lib/ngxs-firestore.module.ts","../../../src/lib/ngxs-firestore.adapter.ts","../../../src/lib/ngxs-firestore.service.ts","../../../src/lib/action-decorator-helpers.ts","../../../src/lib/attach-action.ts","../../../src/lib/ngxs-firestore-connect.service.ts","../../../src/lib/ngxs-firestore-connections.selector.ts","../../../src/ngxs-labs-firestore-plugin.ts"],"sourcesContent":["namespace NgxsFirestoreDebugPayloads {\n  export interface StreamEmitted {\n    id: string;\n    items: any;\n  }\n}\n\nexport namespace NgxsFirestoreConnectActions {\n  export class StreamConnected {\n    static readonly type = '[NgxsFirestore] Connected';\n    constructor(public payload: string) {}\n  }\n  export class StreamEmitted {\n    static readonly type = '[NgxsFirestore] Emitted';\n    constructor(public payload: NgxsFirestoreDebugPayloads.StreamEmitted) {}\n  }\n  export class StreamDisconnected {\n    static readonly type = '[NgxsFirestore] Disconnected';\n    constructor(public payload: string) {}\n  }\n}\n","import { State, StateContext, NgxsOnInit, Action } from '@ngxs/store';\nimport { NgxsFirestoreConnectActions } from './ngxs-firestore-connect.actions';\nimport { patch, insertItem, removeItem, updateItem } from '@ngxs/store/operators';\nimport { Injectable } from '@angular/core';\n\nexport interface FirestoreConnection {\n  id: string;\n  connectedAt: Date;\n  emmitedAt: Date[];\n}\n\nexport interface NgxsFirestoreStateModel {\n  connections: FirestoreConnection[];\n}\n\n@State<NgxsFirestoreStateModel>({\n  name: 'ngxs_firestore',\n  defaults: {\n    connections: []\n  }\n})\n@Injectable()\nexport class NgxsFirestoreState implements NgxsOnInit {\n  ngxsOnInit(_ctx: StateContext<NgxsFirestoreStateModel>) {}\n\n  @Action([NgxsFirestoreConnectActions.StreamConnected])\n  streamConnected(\n    { setState }: StateContext<NgxsFirestoreStateModel>,\n    { payload }: NgxsFirestoreConnectActions.StreamConnected\n  ) {\n    const conn = {\n      connectedAt: new Date(),\n      id: payload\n    } as FirestoreConnection;\n    setState(patch({ connections: insertItem(conn) }));\n  }\n\n  @Action([NgxsFirestoreConnectActions.StreamEmitted])\n  streamEmitted(\n    { setState }: StateContext<NgxsFirestoreStateModel>,\n    { payload }: NgxsFirestoreConnectActions.StreamEmitted\n  ) {\n    const { id } = payload;\n    setState(\n      patch<NgxsFirestoreStateModel>({\n        connections: updateItem((x) => x.id === id, patch({ emmitedAt: insertItem(new Date()) }))\n      })\n    );\n  }\n\n  @Action([NgxsFirestoreConnectActions.StreamDisconnected])\n  streamDisconnected(\n    { setState, getState }: StateContext<NgxsFirestoreStateModel>,\n    { payload }: NgxsFirestoreConnectActions.StreamDisconnected\n  ) {\n    setState(\n      patch<NgxsFirestoreStateModel>({ connections: removeItem((x) => x.id === payload) })\n    );\n  }\n}\n","import { InjectionToken } from '@angular/core';\n\nexport interface NgxsFirestoreModuleOptions {\n  timeoutWriteOperations: number | false;\n}\n\nexport const NGXS_FIRESTORE_MODULE_OPTIONS = new InjectionToken<NgxsFirestoreModuleOptions>(\n  'NGXS_FIRESTORE_MODULE_OPTIONS'\n);\n","export class DisconnectAll {\n  static readonly type = '[NgxsFirestore] DisconnectAll';\n}\n\nexport class Disconnect {\n  static readonly type = '[NgxsFirestore] Disconnect';\n  constructor(public payload: any) {}\n}\n\nexport class GetNextPage {\n  static readonly type = 'GetNextPage';\n  constructor(public payload: string) {}\n}\n\nexport class GetLastPage {\n  static readonly type = 'GetLastPage';\n  constructor(public payload: string) {}\n}\n","import { Injectable } from '@angular/core';\nimport { defer, Observable } from 'rxjs';\nimport { filter, map, startWith, switchMap } from 'rxjs/operators';\nimport { Actions, getActionTypeFromInstance, ofActionDispatched } from '@ngxs/store';\nimport { AngularFirestore, FieldPath, QueryFn } from '@angular/fire/firestore';\nimport { GetNextPage, GetLastPage } from './actions';\nexport interface FirestorePage {\n  limit: number;\n  id: string;\n}\n\n@Injectable()\nexport class NgxsFirestorePageIdService {\n  constructor(private firestore: AngularFirestore) {}\n\n  createId() {\n    return this.firestore.createId();\n  }\n}\n\n@Injectable({ providedIn: 'root' })\nexport class NgxsFirestorePageService {\n  constructor(private actions$: Actions, private pageId: NgxsFirestorePageIdService) {}\n\n  create<T>(\n    queryFn: (pageFn: QueryFn) => Observable<T>,\n    size: number,\n    orderBy: { fieldPath: string | FieldPath; directionStr?: 'desc' | 'asc' }[]\n  ): Observable<{ results: T; pageId: string }> {\n    return defer(() => {\n      const pages: FirestorePage[] = [];\n\n      return this.actions$.pipe(\n        ofActionDispatched(GetNextPage, GetLastPage),\n        startWith('INIT'),\n        map((action) => {\n          const actionType = <'GetNextPage' | 'GetLastPage'>getActionTypeFromInstance(action);\n          const payload = action === 'INIT' ? this.pageId.createId() : action.payload;\n          return { payload, actionType: actionType || 'GetNextPage' };\n        }),\n        filter(({ payload, actionType }) => {\n          return pages.length === 0 || !!pages.find((page) => page.id === payload);\n        }),\n        map(({ payload, actionType }) => {\n          const thePage = pages.find((page) => page.id === payload);\n          let limit = thePage?.limit || 0;\n\n          if (actionType === 'GetNextPage') {\n            limit += size;\n          } else if (limit - size > 0) {\n            limit -= size;\n          }\n\n          const skip = thePage?.limit === limit;\n\n          if (thePage) {\n            thePage.limit = limit;\n          } else {\n            pages.push({ id: payload, limit });\n          }\n\n          return { pageId: payload, limit, skip };\n        }),\n        filter(({ skip }) => {\n          return !skip;\n        }),\n        switchMap(({ pageId, limit }) => {\n          return queryFn((ref) => {\n            return orderBy\n              .reduce((prev, curr) => prev.orderBy(curr.fieldPath, curr.directionStr || 'asc'), ref)\n              .limit(limit);\n          }).pipe(\n            map((results) => {\n              return { results, pageId, pageSize: limit };\n            })\n          );\n        })\n      );\n    });\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { NgxsModule } from '@ngxs/store';\nimport { NgxsFirestoreState } from './ngxs-firestore.state';\nimport { AngularFirestoreModule } from '@angular/fire/firestore';\nimport { NgxsFirestoreModuleOptions, NGXS_FIRESTORE_MODULE_OPTIONS } from './tokens';\nimport { NgxsFirestorePageIdService } from './ngxs-firestore-page.service';\n\n@NgModule({\n  imports: [CommonModule, NgxsModule.forFeature([NgxsFirestoreState]), AngularFirestoreModule]\n})\nexport class NgxsFirestoreModule {\n  public static forRoot(options?: NgxsFirestoreModuleOptions): ModuleWithProviders<NgxsFirestoreModule> {\n    return {\n      ngModule: NgxsFirestoreModule,\n      providers: [\n        {\n          provide: NGXS_FIRESTORE_MODULE_OPTIONS,\n          useValue: options || ({ timeoutWriteOperations: false } as NgxsFirestoreModuleOptions)\n        },\n        {\n          provide: NgxsFirestorePageIdService,\n          useClass: NgxsFirestorePageIdService\n        }\n      ]\n    };\n  }\n}\n","import { AngularFirestore } from '@angular/fire/firestore';\nimport { Inject, Injectable, Optional } from '@angular/core';\nimport { NgxsFirestoreModuleOptions, NGXS_FIRESTORE_MODULE_OPTIONS } from './tokens';\nimport { Store } from '@ngxs/store';\nimport 'firebase/firestore';\n\n@Injectable({ providedIn: 'root' })\nexport class NgxsFirestoreAdapter {\n  constructor(\n    @Inject(AngularFirestore) public firestore: AngularFirestore,\n    @Inject(Store) public store: Store,\n    @Optional() @Inject(NGXS_FIRESTORE_MODULE_OPTIONS) public options: NgxsFirestoreModuleOptions\n  ) {}\n}\n","import { QueryFn, QueryDocumentSnapshot } from '@angular/fire/firestore';\nimport { Observable, from, of } from 'rxjs';\nimport { Inject, Injectable } from '@angular/core';\nimport { map, take, mapTo, timeoutWith } from 'rxjs/operators';\nimport { NgxsFirestoreAdapter } from './ngxs-firestore.adapter';\nimport firebase from 'firebase/app';\nimport 'firebase/firestore';\n\n/**\n * Changes the behavior of a set() call to only replace the values specified\n * in its data argument. Fields omitted from the set() call remain\n * untouched.\n */\ninterface SetOptions {\n  merge: boolean;\n}\n\n@Injectable()\nexport abstract class NgxsFirestore<T> {\n  constructor(@Inject(NgxsFirestoreAdapter) protected adapter: NgxsFirestoreAdapter) {}\n\n  protected abstract path: string;\n  protected idField: string = 'id';\n  protected converter: firebase.firestore.FirestoreDataConverter<T> = {\n    toFirestore: (value) => {\n      return value;\n    },\n    fromFirestore: (snapshot, options) => {\n      return { ...(<T>snapshot.data(options)) };\n    }\n  };\n\n  public createId() {\n    return this.adapter.firestore.createId();\n  }\n\n  public doc$(id: string): Observable<T> {\n    return this.adapter.firestore\n      .doc<T>(this.docRef(id))\n      .snapshotChanges()\n      .pipe(\n        map((docSnapshot) => {\n          if (docSnapshot.payload.exists) {\n            return this.getDataWithId(docSnapshot.payload);\n          } else {\n            return undefined;\n          }\n        })\n      );\n  }\n\n  public docOnce$(id: string): Observable<T> {\n    return this.doc$(id).pipe(take(1));\n  }\n\n  public collection$(queryFn: QueryFn = (ref) => ref): Observable<T[]> {\n    return this.adapter.firestore\n      .collection<T>(this.path, (ref) => {\n        return queryFn(ref.withConverter(this.converter));\n      })\n      .snapshotChanges()\n      .pipe(\n        map((docSnapshots) =>\n          docSnapshots.map((docSnapshot) => {\n            return this.getDataWithId(docSnapshot.payload.doc);\n          })\n        )\n      );\n  }\n\n  public collectionOnce$(queryFn?: QueryFn): Observable<T[]> {\n    return this.collection$(queryFn).pipe(take(1));\n  }\n\n  public update$(id: string, value: Partial<T>, setOptions?: SetOptions) {\n    return this.docSet(id, value, setOptions);\n  }\n\n  public delete$(id: string) {\n    return from(this.doc(id).delete()).pipe();\n  }\n\n  public create$(value: Partial<T>): Observable<string> {\n    return this.upsert$(value);\n  }\n\n  public upsert$(value: Partial<T>, setOptions?: SetOptions): Observable<string> {\n    let id;\n    let newValue;\n\n    if (Object.keys(value).includes(this.idField) && !!value[this.idField]) {\n      id = value[this.idField];\n      newValue = Object.assign({}, value);\n    } else {\n      id = this.createId();\n      newValue = Object.assign({}, value, { [this.idField]: id });\n    }\n\n    return this.docSet(id, newValue, setOptions);\n  }\n\n  private getDataWithId<TData>(doc: QueryDocumentSnapshot<TData>) {\n    const data = doc.data();\n    const id = (data && data[this.idField]) || doc.id;\n    return { ...data, [this.idField]: id };\n  }\n\n  private doc(id: string) {\n    return this.adapter.firestore.doc(this.docRef(id));\n  }\n\n  private docSet(id: string, value: any, setOptions?: SetOptions) {\n    setOptions = setOptions || { merge: true };\n\n    if (this.isOffline()) {\n      this.doc(id).set(value, setOptions);\n      return of(id);\n    }\n\n    if (this.adapter.options && this.adapter.options.timeoutWriteOperations) {\n      return from(this.doc(id).set(value, setOptions)).pipe(\n        timeoutWith(this.adapter.options.timeoutWriteOperations, of(id)),\n        mapTo(id)\n      );\n    } else {\n      return from(this.doc(id).set(value, setOptions)).pipe(mapTo(id));\n    }\n  }\n\n  private docRef(id: string) {\n    return this.adapter.firestore.doc(`${this.path}/${id}`).ref.withConverter(this.converter);\n  }\n\n  private isOffline() {\n    return navigator.onLine !== undefined && !navigator.onLine;\n  }\n}\n","import { ActionType } from '@ngxs/store';\n\nexport function StreamConnected(actionType: ActionType) {\n  return class {\n    static readonly type = `${actionType.type} Connected`;\n    constructor(public action: any) {}\n  };\n}\n\nexport function StreamEmitted(actionType: ActionType) {\n  return class {\n    static readonly type = `${actionType.type} Emitted`;\n    constructor(public action: any, public payload: any) {}\n  };\n}\n\nexport function StreamDisconnected(actionType: ActionType) {\n  return class {\n    static readonly type = `${actionType.type} Disconnected`;\n    constructor(public action: any) {}\n  };\n}\n\nexport function StreamErrored(actionType: ActionType) {\n  return class {\n    static readonly type = `${actionType.type} Errored`;\n    constructor(public action: any, public error: any) {}\n  };\n}\n","import { Action, ActionOptions, ActionType, StateContext } from '@ngxs/store';\n\n/**\n * This key is used to retrieve static metadatas on state classes.\n * This constant is taken from the core codebase\n */\nconst META_OPTIONS_KEY = 'NGXS_OPTIONS_META';\n\nexport function attachAction<S, A>(\n  storeClass: any,\n  action: ActionType,\n  fn: (ctx: StateContext<S>, action: A) => any,\n  options?: ActionOptions\n): void {\n  if (!storeClass[META_OPTIONS_KEY]) {\n    throw new Error('storeClass is not a valid NGXS Store');\n  }\n\n  const methodName = getActionMethodName(action);\n\n  storeClass.prototype[methodName] = function(_state: any, _action: any): any {\n    return fn(_state, _action);\n  };\n\n  Action(action, options)({ constructor: storeClass }, methodName, null);\n}\n\nconst getActionMethodName = (action: ActionType) => {\n  const actionName = action.type.replace(/[^a-zA-Z0-9]+/g, '');\n  return `${actionName}`;\n};\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { Store, ActionType, Actions, ofActionDispatched } from '@ngxs/store';\nimport { tap, catchError, mergeMap, takeUntil, finalize, filter, take, share } from 'rxjs/operators';\nimport { Observable, race, Subscription, Subject, defer, of } from 'rxjs';\nimport { StreamConnected, StreamEmitted, StreamDisconnected, StreamErrored } from './action-decorator-helpers';\nimport { NgxsFirestoreConnectActions } from './ngxs-firestore-connect.actions';\nimport { DisconnectAll, Disconnect } from './actions';\nimport { attachAction } from './attach-action';\nimport { NgxsFirestoreState } from './ngxs-firestore.state';\n\ninterface ActionTypeDef<T> {\n  type: string;\n  new (...args: any): T;\n}\n\nfunction defaultTrackBy(action: any) {\n  return '';\n}\n\nfunction streamId(opts: { actionType: ActionType; action: any; trackBy: (action: any) => string }) {\n  let id = `${opts.actionType.type}`;\n  if (opts.trackBy(opts.action)) {\n    id = id.concat(` (${opts.trackBy(opts.action)})`);\n  }\n  return id;\n}\n\nfunction tapOnce<T>(fn: (value) => void) {\n  return (source: Observable<any>) =>\n    defer(() => {\n      let first = true;\n      return source.pipe(\n        tap<T>((payload) => {\n          if (first) {\n            fn(payload);\n          }\n          first = false;\n        })\n      );\n    }).pipe(share());\n}\n\n@Injectable({ providedIn: 'root' })\nexport class NgxsFirestoreConnect implements OnDestroy {\n  private firestoreConnectionsSub: Subscription[] = [];\n  private activeFirestoreConnections: string[] = [];\n  private actionsPending: string[] = [];\n\n  constructor(private store: Store, private actions: Actions) {}\n\n  /**\n   * Connect a query that will dispatch a `StreamEmitted` action on each emission.\n   *\n   * @param actionType Action to connect with\n   * @param opts.to Firestore Query to connect with\n   * @param opts.trackBy used to allow multiple connections for a same action, and Disconnect them individually\n   * @param opts.connectedActionFinishesOn complete connected action on first emit or stream completed\n   * @param opts.cancelPrevious cancel previous connected action, (when used combined with trackBy, will cancel stream with same id)\n   */\n  connect<T>(\n    actionType: ActionTypeDef<T>,\n    opts: {\n      to: (action: T) => Observable<any>;\n      trackBy?: (action: T) => string;\n      connectedActionFinishesOn?: 'FirstEmit' | 'StreamCompleted';\n      cancelPrevious?: boolean;\n    }\n  ) {\n    const connectedActionFinishesOn = opts.connectedActionFinishesOn || 'FirstEmit';\n    const trackBy = opts.trackBy || defaultTrackBy;\n    const cancelPrevious = opts.cancelPrevious;\n\n    interface CompletedHandler {\n      actionCompletedHandlerSubject: Subject<unknown>;\n    }\n\n    const subjects: { [key: string]: CompletedHandler } = {};\n    function getSubjects(id: string): CompletedHandler {\n      if (!subjects[id]) {\n        const actionCompletedHandlerSubject = new Subject();\n        subjects[id] = {\n          actionCompletedHandlerSubject\n        };\n      }\n\n      return subjects[id];\n    }\n\n    attachAction(NgxsFirestoreState, actionType, (_stateContext, action) => {\n      const { actionCompletedHandlerSubject } = getSubjects(streamId({ actionType, action, trackBy }));\n\n      const completed$ = actionCompletedHandlerSubject.asObservable().pipe(take(1));\n\n      if (cancelPrevious) {\n        return completed$;\n      }\n\n      if (this.activeFirestoreConnections.includes(streamId({ actionType, action, trackBy }))) {\n        return;\n      }\n\n      if (this.actionsPending.includes(streamId({ actionType, action, trackBy }))) {\n        return completed$;\n      }\n\n      return completed$;\n    });\n\n    const actionDispatched$ = this.actions.pipe(\n      ofActionDispatched(actionType),\n      // filter actions not connected already\n      // or cancelPrevious\n      filter((action) => {\n        return cancelPrevious || !this.activeFirestoreConnections.includes(streamId({ actionType, action, trackBy }));\n      }),\n      // filter actions dispatched on same tick\n      filter((action) => {\n        return !this.actionsPending.includes(streamId({ actionType, action, trackBy }));\n      }),\n      tap((action) => {\n        this.actionsPending.push(streamId({ actionType, action, trackBy }));\n      })\n    );\n\n    const firestoreStreamHandler$ = (action) => {\n      const streamFn = opts.to;\n      return streamFn(action).pipe(\n        // connected\n        tapOnce((_) => {\n          const StreamConnectedClass = StreamConnected(actionType);\n          this.store.dispatch(new StreamConnectedClass(action));\n          this.activeFirestoreConnections.push(streamId({ actionType, action, trackBy }));\n          // remove from actionsPending once connected\n          this.actionsPending.splice(this.actionsPending.indexOf(streamId({ actionType, action, trackBy })), 1);\n\n          this.store.dispatch(\n            new NgxsFirestoreConnectActions.StreamConnected(streamId({ actionType, action, trackBy }))\n          );\n        }),\n        // emmited\n        tap((payload) => {\n          const StreamEmittedClass = StreamEmitted(actionType);\n          this.store.dispatch(new StreamEmittedClass(action, payload));\n          this.store.dispatch(\n            new NgxsFirestoreConnectActions.StreamEmitted({\n              id: streamId({ actionType, action, trackBy }),\n              items: payload\n            })\n          );\n        }),\n        // completed if FirstEmit\n        tapOnce(() => {\n          if (connectedActionFinishesOn === 'FirstEmit') {\n            const { actionCompletedHandlerSubject } = getSubjects(streamId({ actionType, action, trackBy }));\n            actionCompletedHandlerSubject.next(action);\n          }\n        }),\n        // disconnect on Disconnect\n        takeUntil(\n          race(\n            this.actions.pipe(ofActionDispatched(DisconnectAll)),\n            this.actions.pipe(ofActionDispatched(Disconnect)).pipe(\n              filter((disconnectAction) => {\n                const { payload } = disconnectAction;\n                if (!payload) {\n                  return false;\n                }\n                const disconnectedStreamId = streamId({\n                  actionType: payload.constructor || payload,\n                  action: disconnectAction.payload,\n                  trackBy\n                });\n                if (disconnectedStreamId === streamId({ actionType, action, trackBy })) {\n                  return true;\n                }\n\n                return false;\n              })\n            )\n          )\n        ),\n        // disconnect on action re-dispatched\n        takeUntil(\n          this.actions.pipe(\n            ofActionDispatched(actionType),\n            filter((dispatchedAction) => {\n              if (!cancelPrevious) {\n                return false;\n              }\n              //SELF\n              if (dispatchedAction === action) {\n                return false;\n              }\n              const dispatchedActionStreamId = streamId({\n                actionType,\n                action: dispatchedAction,\n                trackBy\n              });\n              return dispatchedActionStreamId === streamId({ actionType, action, trackBy });\n            })\n          )\n        ),\n        finalize(() => {\n          const StreamDisconnectedClass = StreamDisconnected(actionType);\n          this.store.dispatch(new StreamDisconnectedClass(action));\n          this.store.dispatch(\n            new NgxsFirestoreConnectActions.StreamDisconnected(streamId({ actionType, action, trackBy }))\n          );\n          this.activeFirestoreConnections.splice(\n            this.activeFirestoreConnections.indexOf(streamId({ actionType, action, trackBy })),\n            1\n          );\n\n          // completed if StreamCompleted\n          if (connectedActionFinishesOn === 'StreamCompleted') {\n            const { actionCompletedHandlerSubject } = getSubjects(streamId({ actionType, action, trackBy }));\n            actionCompletedHandlerSubject.next(action);\n          }\n        }),\n        catchError((err) => {\n          const { actionCompletedHandlerSubject } = getSubjects(streamId({ actionType, action, trackBy }));\n          actionCompletedHandlerSubject.error(err);\n\n          const StreamErroredClass = StreamErrored(actionType);\n          this.store.dispatch(new StreamErroredClass(action, err));\n\n          return of({});\n        })\n      );\n    };\n\n    this.firestoreConnectionsSub.push(actionDispatched$.pipe(mergeMap(firestoreStreamHandler$)).subscribe());\n  }\n\n  ngOnDestroy() {\n    if (this.firestoreConnectionsSub) {\n      this.firestoreConnectionsSub.forEach((sub) => sub.unsubscribe());\n    }\n  }\n}\n","import { createSelector } from '@ngxs/store';\nimport { NgxsFirestoreState, NgxsFirestoreStateModel } from './ngxs-firestore.state';\n\nexport const ngxsFirectoreConnections = createSelector([NgxsFirestoreState], (state: NgxsFirestoreStateModel) => {\n  return state.connections;\n});\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {NgxsFirestoreConnectActions as ɵb} from './lib/ngxs-firestore-connect.actions';\nexport {NgxsFirestoreState as ɵa} from './lib/ngxs-firestore.state';\nexport {NGXS_FIRESTORE_MODULE_OPTIONS as ɵd,NgxsFirestoreModuleOptions as ɵc} from './lib/tokens';"],"names":["NgxsFirestoreConnectActions","NgxsFirestoreState","patch","insertItem","updateItem","removeItem","Injectable","Action","State","InjectionToken","AngularFirestore","defer","ofActionDispatched","startWith","map","getActionTypeFromInstance","filter","switchMap","Actions","NgModule","CommonModule","NgxsModule","AngularFirestoreModule","Inject","Store","Optional","take","from","of","timeoutWith","mapTo","tap","share","Subject","takeUntil","race","finalize","catchError","mergeMap","createSelector"],"mappings":"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"}